<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

</body>
<script>
  // promise
  class MyPromise {
    constructor(runner) {
      this.state = 'pending';
      this.successQueue = [];
      this.value = '';
      
      let resolve = (data) => {
        if (this.state === 'pending') {
          this.state = 'success';
          this.value = data;
          this.successQueue.forEach(cb => {
            cb(this.value);
          })
        }
      }
      runner(resolve);
    }

    then(callback) {
      const newPromise = new MyPromise((resolve) => {
        if (this.state === 'pending') {
          this.successQueue.push(() => {
            resolve(callback(this.value));
          })
        } else if (this.state === 'success') {
          resolve(callback(this.value));
        }
      });
      return newPromise;
    }
  }

  const testPromise = new MyPromise((resolve) => {
    setTimeout(() => {
      resolve(123);
    }, 2000);
  });
  testPromise.then((res) => {
    console.log(res, 'one');
    return res + 1;
  }).then(res => {
    console.log(res, 'two');
  })
</script>

</html>